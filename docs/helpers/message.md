# Message
Класс для работы с сообщением. Этот класс передается во второй параметр функции-обработчика [команды](../modules/botengine.md#oncommands).

```php
$vk->bot->hear(['default'], function($data, $msg) {
	// Работа с $msg
});
```

> Для нормальной работы этого и других классов необходимо задать конфиг. Документации на эту тему скорее всего не будет, поэтому советую использовать [vk](vk.md).

Ниже представлено описание нужных вам методов этого класса.

## from
Получить ID отправителя сообщения.

```php
$msg->from(); // int
```

## isChat
Сообщение пришло из чата или нет

```php
$msg->isChat(); // bool
```

## isOut
Сообщение отправлено текущим пользователем или нет. Используется при проверке команд для бота-пользователя

```php
$msg->isOut(); // bool
```

## hasAttachs
Есть ли у сообщения прикреплённые вложения?

```php
$msg->hasAttachs(); // bool
```

## hasId
Есть ли у сообщения ID?

```php
$msg->hasId(); // bool
```

## send
Отправить сообщение в тот же диалог, к которому принадлежит текущее. Возвращает результат вызова функции [call](../modules/requests.md#call)

| Параметр     | Тип    | Описание                                                                     |
|--------------|--------|------------------------------------------------------------------------------|
| $text        | string | Текст сообщения                                                              |
| $params      | array  | [Дополнительные параметры](https://vk.com/dev/messages.send)                 |
| $for_execute | bool   | Если `true`, вернётся массив, который можно передать в [Execute](execute.md) |

```php
$msg->send('Простой ответ на сообщение');
```

### Клавиатура
Если вы укажите в `$params['keyboard']` массив, он будет автоматически перекодирован в JSON. Простой пример:

```php
$msg->send('Клавиатура', ['keyboard' => ['one_time' => false, 'buttons' => []]]);
/**
 * В запросе будет
 * keyboard = {"one_time":false,"buttons":[]}
 */
```

### Макросы
В `$text` вы можете использовать макросы, позволяющие использовать некоторые данные пользователя без дополнительных ручных запросов.

| Макрос | Описание                                                                                                |
|--------|---------------------------------------------------------------------------------------------------------|
| %fn%   | Имя пользователя                                                                                        |
| %ln%   | Фамилия пользователя                                                                                    |
| %full% | Полное имя пользователя                                                                                 |
| %fnp%  | Упоминание с текстом `%full%`. Итоговая строка будет примерно такой: `@id305360617 (Матвей Вишневский)` |
| %fip%  | Упоминание с текстом `%fn%`. Итоговая строка будет примерно такой: `@id305360617 (Матвей)`              |
| %lnp%  | Упоминание с текстом `%ln%`. Итоговая строка будет примерно такой: `@id305360617 (Вишневский)`          |
| %sn%   | `screen_name` пользователя                                                                              |
| %id%   | ID пользователя                                                                                         |

```php
$msg->send('Привет, %fn%!');
// Привет, Матвей!
```

## reply
Ответить на сообщение, используя параметр `reply_to`. Если у текущего сообщения нет ID, будет отправлено обычное сообщение. Под капотом использует функцию `send` с теми же параметрами.

## kickMember
Обёртка над `messages.removeChatUser`. Возвращает результат вызова функции [call](../modules/requests.md#call)

Если текущее сообщение пришло не из чата (`peer_id < 2e9`), будет выброшено исключение [MessageApiException](../modules/exceptions.md#msgapi)

| Параметр   | Тип   | Описание                                                |
|------------|-------|---------------------------------------------------------|
| $member_id | int   | [member_id](https://vk.com/dev/messages.removeChatUser) |
| $params    | array | Дополнительные параметры                                |

```php
$msg->kickMember(305360617);
```

## pin
Закрепить текущее сообщение с помощью `messages.pin`. Возвращает результат вызова функции [call](../modules/requests.md#call)

Если текущее сообщение не имеет ID, будет выброшено исключение [MessageApiException](../modules/exceptions.md#msgapi)

```php
$msg->pin();
```

## unpin
Отрекпить сообщение в текущем чате. Возвращает результат вызова функции [call](../modules/requests.md#call)

```php
$msg->unpin();
```