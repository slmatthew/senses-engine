# Debugger
Класс, позволяющий вам дебажить запросы к API.

## Основной класс — Debugger
Создание дебаггера производится через этот класс.

### Конструктор

| Параметр | Тип   | Описание                                            |
|----------|-------|-----------------------------------------------------|
| $types   | array | Список [типов](#типы-событий) событий для обработки |

```php
$dbg = new Debugger([
	DebuggerEvents::API_CALL
]);
```

### on
Добавить обработчик события.

|
|
| $type    | string   | [Тип события](#типы-событий)                                        |
| $handler | callable | Функция-обработчик, принимающая единственный аргумент `array $data` |

Если вы укажете тип, который не указали в конструкторе, обработчик никогда не будет вызван.

```php
$dbg->on(DebuggerEvents::API_CALL, function($data) {
	print_r($data);
});
```

## Типы событий
Константы с именами типов событий хранятся в классе `DebuggerEvents`. Вы в любой момент можете получить доступ к ним.

Ниже описаны типы событий и их структура. В заголовке — название константы.

Доступ к полям, описанным в этом разделе, можно получить так:

```php
$dbg->on(DebuggerEvents::API_CALL, function($data) {
	echo $data['method'];
});
```

### API_CALL
Вызов метода API.

| Поле   | Тип    | Описание           |
|--------|--------|--------------------|
| method | string | Название метода    |
| params | array  | Параметры метода   |
| agent  | string | User-Agent запроса |

### API_ERROR
Произошла ошибка API. Вызывается только при включённом [диалоге для ошибок](../helpers/authstorage.md#seterrorspeer).

В массиве есть два поля: `on` и `error`.

Структура `on` идентична структуре события [API_CALL](#api_call).

Структура `error`:

| Поле  | Тип    | Описание             |
|-------|--------|----------------------|
| code  | int    | Код ошибки           |
| msg   | string | Описание ошибки      |
| other | array  | Весь ответ от VK API |

### API_RESULT
Получен ответ от API.

| Поле   | Тип    | Описание                                               |
|--------|--------|--------------------------------------------------------|
| method | string | Название метода                                        |
| params | string | Параметры метода, пропущенные через `http_build_query` |
| result | array  | Результат запроса                                      |

### LP_START
Начало запросов к LP-серверу.

| Поле      | Тип    | Описание                                                             |
|-----------|--------|----------------------------------------------------------------------|
| lp_server | array  | Ответ от `groups.getLongPollServer` или `messages.getLongPollServer` |
| url       | string | Сформированный URL, на который отправляются запросы                  |
| type      | string | `community` или `user`                                               |

### LP_FIRST_UPDATES
Получены первые новые данные.

Пустой массив.

### LP_FAILED
В ответе от LP-сервера есть поле `failed`.

| Поле   | Тип   | Описание                                    |
|--------|-------|---------------------------------------------|
| failed | int   | Значение поля `failed` из ответа LP-сервера |
| result | array | Полный ответ LP-сервера                     |

### LP_DATA_UPDATED
Успешно обновлены данные для подключения к LP-серверу.

| Поле | Тип    | Описание                                                             |
|------|--------|----------------------------------------------------------------------|
| lp   | array  | Ответ от `groups.getLongPollServer` или `messages.getLongPollServer` |
| url  | string | Сформированный URL, на который отправляются запросы                  |

### LP_TS_UPDATED
Обновлен `ts`.

| Поле | Тип    | Описание                                            |
|------|--------|-----------------------------------------------------|
| ts   | int    | Значение поля `ts` из ответа LP-сервера             |
| url  | string | Сформированный URL, на который отправляются запросы |

> Этот тип может прийти в особых случаях и никогда не тестировался.